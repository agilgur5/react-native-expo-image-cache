var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _extends3=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf3=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _=_interopRequireWildcard(require("lodash"));var React=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _expo=require("expo");var _CacheManager=_interopRequireDefault(require("./CacheManager"));var _jsxFileName="/Users/agilgur5/Desktop/GitHub/react-native-expo-image-cache/src/Image.js";var Image=function(_React$Component){(0,_inherits2.default)(Image,_React$Component);function Image(){var _getPrototypeOf2;var _this;(0,_classCallCheck2.default)(this,Image);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=(0,_possibleConstructorReturn2.default)(this,(_getPrototypeOf2=(0,_getPrototypeOf3.default)(Image)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.mounted=true;_this.state={uri:undefined,intensity:new _reactNative.Animated.Value(100)};return _this;}(0,_createClass2.default)(Image,[{key:"load",value:function load(_ref){var uri,_ref$options,options,path;return _regenerator.default.async(function load$(_context){while(1){switch(_context.prev=_context.next){case 0:uri=_ref.uri,_ref$options=_ref.options,options=_ref$options===void 0?{}:_ref$options;if(!uri){_context.next=6;break;}_context.next=4;return _regenerator.default.awrap(_CacheManager.default.get(uri,options).getPath());case 4:path=_context.sent;if(this.mounted){this.setState({uri:path});}case 6:case"end":return _context.stop();}}},null,this);}},{key:"componentDidMount",value:function componentDidMount(){this.load(this.props);}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){var _this$props=this.props,preview=_this$props.preview,transitionDuration=_this$props.transitionDuration;var _this$state=this.state,uri=_this$state.uri,intensity=_this$state.intensity;if(this.props.uri!==prevProps.uri){this.load(this.props);}else if(uri&&preview&&prevState.uri===undefined){_reactNative.Animated.timing(intensity,{duration:transitionDuration,toValue:0,useNativeDriver:_reactNative.Platform.OS==="android"}).start();}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.mounted=false;}},{key:"render",value:function render(){var _this$props2=this.props,preview=_this$props2.preview,style=_this$props2.style,defaultSource=_this$props2.defaultSource,tint=_this$props2.tint,otherProps=(0,_objectWithoutProperties2.default)(_this$props2,["preview","style","defaultSource","tint"]);var _this$state2=this.state,uri=_this$state2.uri,intensity=_this$state2.intensity;var hasDefaultSource=!!defaultSource;var hasPreview=!!preview;var isImageReady=!!uri;var opacity=intensity.interpolate({inputRange:[0,100],outputRange:[0,0.5]});var computedStyle=[_reactNative.StyleSheet.absoluteFill,_.transform(_.pickBy(_reactNative.StyleSheet.flatten(style),function(value,key){return propsToCopy.indexOf(key)!==-1;}),function(result,value,key){return(0,_extends3.default)(result,(0,_defineProperty2.default)({},key,value-(style.borderWidth||0)));})];return React.createElement(_reactNative.View,(0,_extends3.default)({style:style},{__source:{fileName:_jsxFileName,lineNumber:90}}),hasDefaultSource&&!hasPreview&&!isImageReady&&React.createElement(_reactNative.Image,(0,_extends3.default)({source:defaultSource,style:computedStyle},otherProps,{__source:{fileName:_jsxFileName,lineNumber:93}})),hasPreview&&React.createElement(_reactNative.Image,{source:preview,resizeMode:"cover",style:computedStyle,blurRadius:_reactNative.Platform.OS==="android"?0.5:0,__source:{fileName:_jsxFileName,lineNumber:102}}),isImageReady&&React.createElement(_reactNative.Image,(0,_extends3.default)({source:{uri:uri},style:computedStyle},otherProps,{__source:{fileName:_jsxFileName,lineNumber:112}})),hasPreview&&_reactNative.Platform.OS==="ios"&&React.createElement(AnimatedBlurView,(0,_extends3.default)({style:computedStyle},{intensity:intensity,tint:tint},{__source:{fileName:_jsxFileName,lineNumber:121}})),hasPreview&&_reactNative.Platform.OS==="android"&&React.createElement(_reactNative.Animated.View,{style:[computedStyle,{backgroundColor:tint==="dark"?black:white,opacity:opacity}],__source:{fileName:_jsxFileName,lineNumber:126}}));}}]);return Image;}(React.Component);exports.default=Image;Image.defaultProps={transitionDuration:300,tint:"dark"};var black="black";var white="white";var propsToCopy=["borderRadius","borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"];var AnimatedBlurView=_reactNative.Animated.createAnimatedComponent(_expo.BlurView);
//# sourceMappingURL=Image.js.map